<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" type="text/css" id="css" href="style.css"/>
    </head>
    
	<body >
 <script src="script/background.js"></script>
 <script src="script/include.js"></script>
 <script src="script/jquery.js"></script>
 <script src="script/textEffect.js"></script>
 <script src="script/jcanvas.min.js"></script>
 
 <script src="lib/quintus.js"></script>
 <script src="lib/quintus_2d.js"></script>
 <script src="lib/quintus_2d2.js"></script>
 <script src="lib/quintus_anim.js"></script>
 <script src="lib/quintus_audio.js"></script>
 <script src="lib/quintus_input.js"></script>
 <script src="lib/quintus_scenes.js"></script>
 <script src="lib/quintus_sprites.js"></script>
 <script src="lib/quintus_touch.js"></script>
 <script src="lib/quintus_ui.js"></script>
 
	<div id='loading'>
		<div id='loading_container'>
        	Loading...
        	<div id='loading_progress'>
            </div>
      	</div>
    </div>
    
	<canvas id='Quintus' width='960' height='610' style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
	<canvas id='Jquery' width='960' height='300' style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>

<script>
	var widt = ((document.documentElement.clientWidth -960)/2)-1;
	var obj = document.getElementById('Jquery');
	obj.style.left = widt+"px";
</script>


<script>	
	
	var wi = 960;
	var hi = 610;
	
	// Initialisation du moteur de jeu
        var Q = Quintus()
            .include("Audio, Sprites, Scenes, Input, 2D, 2D2, Touch, UI")
			.setup("Quintus", {
                width: 960,
                height: 610,
                development: true,
				upsampleWidth:  420, 
  				upsampleHeight: 320,  
				downsampleWidth: 1024, 
  				downsampleHeight: 768 ,
				maximize: "touch"
			})
			.enableSound()
			.controls()
			.touch();
	
		var scene_courante = null;
		var scene_prec = null;
		
	    var pause = false;
		Q.input.on("pause", function () {  
			if (scene_courante == "lvl1" || scene_courante == "lvl2" || 
			    scene_courante == "lvl3" || scene_courante == "lvl4" || scene_courante == "pause" ){
					if (!echap){
						if (!pause){
							Q.stageScene('PauseAff',2);
							Q.stage().pause();
							scene_prec = scene_courante;
							scene_courante = "pause";
						}else{
							Q.stageScene('Blanc',2);
							Q.stage().unpause();
							scene_courante=scene_prec;
							scene_prec = "pause";
						}
						pause = !pause;
					}
			}
		});﻿	
		
		
		Q.input.on("replay", function () {  
			if (scene_courante != null && !pause){	
				if (scene_courante == "lvl1"){
					Q.clearStages();
      				Q.stageScene('level1');
					Q.stageScene("gameStats",1);
					music = true;
				}
				if (scene_courante == "lvl2"){
					Q.clearStages();
					
					Q.audio.stop('lvl2.mp3');
					music = false;
					
      				Q.stageScene('level2');
					Q.stageScene("gameStats",1);
					Q.audio.play('lvl2.mp3',{ loop: true });
					music = true;
				}
				if (scene_courante == "lvl3"){
					Q.clearStages();
      				Q.stageScene('level3');
					Q.stageScene("gameStats",1);
					music = true;
				}
				if (scene_courante == "lvl4"){
					Q.clearStages();
      				Q.stageScene('level4');
					Q.stageScene("gameStats",1);
					music = true;
				}
			}
		});﻿	
		
		var music = false;
		Q.input.on("musique", function () {  
			if (scene_courante != null && !pause && !music){	
				if (scene_courante == "lvl1"){
				}
				if (scene_courante == "lvl2"){
					Q.audio.play('lvl2.mp3',{ loop: true });
					music = true;
				}
				if (scene_courante == "lvl3"){
				}
				if (scene_courante == "lvl4"){
				}
			}else{
				Q.audio.stop(); 
				music = false;
			}
		});﻿	
		
		var echap = false
		Q.input.on("echap", function () {  
			if (scene_courante == "lvl1" || scene_courante == "lvl2" || 
			    scene_courante == "lvl3" || scene_courante == "lvl4" || scene_courante == "pause" ){
				if (!pause){
					if (!echap){
						Q.stageScene('Echp',2);
					}else{
						Q.stageScene('Blanc',2);	
					}
					echap = !echap;
				}
			}
		});﻿	
		
		Q.audio.enableWebAudioSound();


    // Création des Personnages / Ennemis / Composants / Affichage
		include ('personnage.js');
        include ('ennemis.js');
		include ('components.js');
		include ('affichage.js');
		
		
	// Ajout des scenes lvl
		include ('lvl1.js');
		include ('lvl2.js');
		include ('lvl3.js');
		include ('lvl4.js');
		
		
	// Charge tous les éléments
        Q.load(["tiles_map.png", "dessous.png", "jump.png", "orange.png", "tomate.png",
			"banane.png", "ananas.png", "slime3.png", "fly.png", "Lvl1.tmx", "Lvl2.tmx",
			"Lvl3.tmx", "Lvl4.tmx", "men.tmx", "fond_pierre.png","fond_pierre_haut.png",
			"fond_pierre_haut2.png", "htmltiles.jpg", "pause.png", "play.png",
			"jumpn.png", "lvl2.mp3", "grille70.png", "grille200.png","grille140.png", "push.png",
			"push2.png", "fond_pierre2.png", "pierre_haut.png", "pierre_haut2.png",
			"plateforme.png","plateforme2.png","cabine.png","bouletr.png","mort.png","boule.png",
			"grille200H.png"
			]
		, function() {
 			
			Q.sheet("tiles","tiles_map.png", { tilew: 70, tileh: 70});  
			Q.sheet("tilesmenu","htmltiles.jpg", { tilew: 70, tileh: 70});   			
			Q.stageScene("Debut");
			
		}, { 
			progressCallback: function(loaded,total) {
   			var element = document.getElementById("loading_progress");
    		element.style.width = Math.floor(loaded/total*100) + "%";
  			}	
        });
 
</script>

		</div>  
    </body>
</html>