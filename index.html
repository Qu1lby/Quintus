<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" type="text/css" id="css" href="style.css"/>
    </head>
    
	<body >
 <script src="script/background.js"></script>
 <script src="script/include.js"></script>
 
 <script src="lib/quintus.js"></script>
 <script src="lib/quintus_2d.js"></script>
 <script src="lib/quintus_2d2.js"></script>
 <script src="lib/quintus_anim.js"></script>
 <script src="lib/quintus_audio.js"></script>
 <script src="lib/quintus_input.js"></script>
 <script src="lib/quintus_scenes.js"></script>
 <script src="lib/quintus_sprites.js"></script>
 <script src="lib/quintus_touch.js"></script>
 <script src="lib/quintus_ui.js"></script>

	<div id='loading'>
		<div id='loading_container'>
        	Loading...
        	<div id='loading_progress'>
            </div>
      	</div>
    </div>

<script>		
	var wi = document.documentElement.clientWidth * 0.9;
	if (wi>960){wi=960;}
	var hi = document.documentElement.clientHeight -40 ;
	if (hi>610){hi=610;}
	
	// Initialisation du moteur de jeu
        var Q = Quintus()
            .include("Audio, Sprites, Scenes, Input, 2D, 2D2, Touch, UI")
			.setup({
                width: wi,
                height: hi,
                development: true,
				upsampleWidth:  420, 
  				upsampleHeight: 320,  
				downsampleWidth: 1024, 
  				downsampleHeight: 768 ,
				maximize: "touch"
				//maximize : true
			})
			//.enableSound()
			.controls()
			.touch();
	
		var scene_courante = null;
		var scene_prec = null;
		
	    var pause = false;
		Q.input.on("pause", function () {  
			if (scene_courante == "lvl1" || scene_courante == "lvl2" || 
			    scene_courante == "lvl3" || scene_courante == "lvl4" || scene_courante == "pause" ){
				if (!pause){
					Q.stageScene('PauseAff',2);
					Q.stage().pause();
					scene_prec = scene_courante;
					scene_courante = "pause";
				}else{
					Q.stageScene('PauseFin',2);
					Q.stage().unpause();
					scene_courante=scene_prec;
					scene_prec = "pause";
				}
				pause = !pause;
			}
		});﻿	
		
		Q.input.on("replay", function () {  
			if (scene_courante != null && !pause){	
				if (scene_courante == "lvl1"){
					Q.clearStages();
      				Q.stageScene('level1');
					Q.stageScene("gameStats",1);
				}
				if (scene_courante == "lvl2"){
					Q.clearStages();
      				Q.stageScene('level2');
					Q.stageScene("gameStats",1);
				}
				if (scene_courante == "lvl3"){
					Q.clearStages();
      				Q.stageScene('level3');
					Q.stageScene("gameStats",1);
				}
				if (scene_courante == "lvl4"){
					Q.clearStages();
      				Q.stageScene('level4');
					Q.stageScene("gameStats",1);
				}
			}
		});﻿	

    // Création des Personnages / Ennemis / Composants / Affichage
		include ('personnage.js');
        include ('ennemis.js');
		include ('components.js');
		include ('affichage.js');
		
		
	// Ajout des scenes lvl
		include ('lvl1.js');
		include ('lvl2.js');
		include ('lvl3.js');
		include ('lvl4.js');
		
		
	// Charge tous les éléments
        Q.load(["tiles_map.png", "orange.png", "tomate.png",  "banane.png", "ananas.png", "slime2.png", "fly.png", "Lvl1.tmx", "Lvl2.tmx", "Lvl3.tmx", "Lvl4.tmx", "men.tmx", "fond_pierre.png","fond_pierre_haut.png","fond_pierre_haut2.png", "htmltiles.jpg", "neige.png", "pause.png", "play.png"
		]
		, function() {
 			
			Q.sheet("tiles","tiles_map.png", { tilew: 70, tileh: 70});  
			Q.sheet("tilesmenu","htmltiles.jpg", { tilew: 70, tileh: 70});   			
			Q.stageScene("Debut");
			
		}, { 
			progressCallback: function(loaded,total) {
   			var element = document.getElementById("loading_progress");
    		element.style.width = Math.floor(loaded/total*100) + "%";
  			}		
			 
        });
 
</script>

		</div>  
    </body>
</html>